<h3>参数</h3>
<div class="location">
  @for (refine of refines(); track $index) {
    <nz-row>
      <nz-col nzSpan="6">
        <nz-select class="select" [ngModel]="refine.flag"
                   (ngModelChange)="changeValue('refines','flag',$index,$event)">
          <nz-option nzLabel="文件名" nzValue="Filename"></nz-option>
          <nz-option nzLabel="类型" nzValue="FileType"></nz-option>
        </nz-select>
      </nz-col>
      @if (refine.flag === 'Filename') {
        <nz-col nzSpan="6">
          <nz-select class="select" [ngModel]="refine.type"
                     (ngModelChange)="changeValue('refines','type',$index,$event)">
            <nz-option nzLabel="是" nzValue="Is"></nz-option>
            <nz-option nzLabel="不是" nzValue="Not"></nz-option>
            <nz-option nzLabel="包含" nzValue="Contains"></nz-option>
            <nz-option nzLabel="不包含" nzValue="NotContains"></nz-option>
            <nz-option nzLabel="开头" nzValue="Begin"></nz-option>
            <nz-option nzLabel="结尾" nzValue="End"></nz-option>
          </nz-select>
        </nz-col>
      } @else if (refine.flag === 'FileType') {
        <nz-col [nzSpan]="refine.type !== 'Folder'?6:14">
          <nz-select class="select" [ngModel]="refine.type"
                     (ngModelChange)="changeValue('refines','type',$index,$event)">
            <nz-option nzLabel="是" nzValue="Is"></nz-option>
            <nz-option nzLabel="不是" nzValue="Not"></nz-option>
            <nz-option nzLabel="是文件夹" nzValue="Folder"></nz-option>
          </nz-select>
        </nz-col>
      }
      @if (refine.flag !== 'FileType' || (refine.flag === 'FileType' && refine.type !== 'Folder')) {
        <nz-col nzSpan="8">
          <input type="text" nz-input [ngModel]="refine.input"
                 (ngModelChange)="changeValue('refines','input',$index,$event)">
        </nz-col>
      }
      <nz-col nzSpan="2" class="icon" [ngClass]="{'disabled':refines().length===1}"
              (click)="delete('refines',$index)">
        <nz-icon nzType="minus-circle" nzTheme="outline"/>
      </nz-col>
      <nz-col nzSpan="2" class="icon" nz-dropdown nzTrigger="click" [nzDropdownMenu]="addRefineMenu">
        <nz-icon nzType="plus-circle" nzTheme="outline"/>
      </nz-col>
    </nz-row>
  }
</div>
<nz-dropdown-menu #addRefineMenu="nzDropdownMenu">
  <ul nz-menu>
    <li nz-menu-item (click)="add('refines','flag','Filename')">文件名</li>
    <li nz-menu-item (click)="add('refines','flag','FileType')">类型</li>
  </ul>
</nz-dropdown-menu>
<nz-divider></nz-divider>
<h3>位置</h3>
<div class="location">
  @for (include of includes(); track $index) {
    <nz-row>
      <nz-col nzSpan="20">
        @if (include.flag === 'Input') {
          <input type="text" nz-input [ngModel]="include.input"
                 (ngModelChange)="changeValue('includes','input',$index,$event)">
        } @else {
          <nz-select class="select" [ngModel]="include.input"
                     (ngModelChange)="change('includes','input',$index,$event)">
            @for (option of includesOptions(); track $index) {
              <nz-option [nzValue]="option.input" [nzLabel]="option.label"></nz-option>
            }
            <nz-option nzValue="~" nzLabel="用户HOME目录" [nzDisabled]="hasHomeInclude"></nz-option>
            <nz-option nzValue="" nzLabel="输入路径"></nz-option>
            <nz-option nzValue="$CUSTOM$" nzLabel="手动选择路径"></nz-option>
          </nz-select>
        }
      </nz-col>
      <nz-col nzSpan="2" class="icon" [ngClass]="{'disabled':includes().length===1}"
              (click)="delete('includes',$index)">
        <nz-icon nzType="minus-circle" nzTheme="outline"/>
      </nz-col>
      <nz-col nzSpan="2" class="icon"
              nz-dropdown nzTrigger="click" [nzDropdownMenu]="addIncludeMenu">
        <nz-icon nzType="plus-circle" nzTheme="outline"/>
      </nz-col>
    </nz-row>
  }

  @for (exclude of excludes(); track $index) {
    <nz-row>
      <nz-col nzSpan="3" class="exclude-span">
        <span>排除:</span>
      </nz-col>
      <nz-col nzSpan="17">
        @if (exclude.flag === 'Input') {
          <input type="text" nz-input [ngModel]="exclude.input"
                 (ngModelChange)="changeValue('excludes','input',$index,$event)">
        } @else {
          <nz-select class="select" [ngModel]="exclude.input"
                     (ngModelChange)="change('excludes','input',$index,$event)">
            @for (option of excludesOptions(); track $index) {
              <nz-option [nzValue]="option.input" [nzLabel]="option.label"></nz-option>
            }
            <nz-option nzValue="" nzLabel="输入路径"></nz-option>
            <nz-option nzValue="$CUSTOM$" nzLabel="手动选择路径"></nz-option>
          </nz-select>
        }
      </nz-col>
      <nz-col nzSpan="2" class="icon" (click)="delete('excludes',$index)">
        <nz-icon nzType="minus-circle" nzTheme="outline"/>
      </nz-col>
      <nz-col nzSpan="2" class="icon" nz-dropdown nzTrigger="click" [nzDropdownMenu]="addExcludeMenu">
        <nz-icon nzType="plus-circle" nzTheme="outline"/>
      </nz-col>
    </nz-row>
  }

  @if (excludes().length === 0) {
    <nz-row>
      <nz-col nzOffset="4">
        <button nz-button nz-dropdown nzTrigger="click" [nzDropdownMenu]="addExcludeMenu">
          <nz-icon nzType="plus"/>
          排除路径
        </button>
      </nz-col>
    </nz-row>
  }
</div>

<nz-dropdown-menu #addIncludeMenu="nzDropdownMenu">
  <ul nz-menu>
    @for (option of includesOptions(); track $index) {
      <li nz-menu-item (click)="add('includes','input',option.input)">{{ option.input }}</li>
    }
    @if (!hasHomeInclude) {
      <li nz-menu-item (click)="add('includes','input','~')">用户HOME目录</li>
    }
    <li nz-menu-item (click)="add('includes','input','')">输入路径</li>
    <li nz-menu-item (click)="add('includes','input','$CUSTOM$')">手动选择路径</li>
  </ul>
</nz-dropdown-menu>
<nz-dropdown-menu #addExcludeMenu="nzDropdownMenu">
  <ul nz-menu>
    @for (option of excludesOptions(); track $index) {
      <li nz-menu-item (click)="add('excludes','input',option.input)">{{ option.input }}</li>
    }
    <li nz-menu-item (click)="add('excludes','input','')">输入路径</li>
    <li nz-menu-item (click)="add('excludes','input','$CUSTOM$')">手动选择路径</li>
  </ul>
</nz-dropdown-menu>

@if (isDevMode) {
  <nz-divider></nz-divider>
  <button (click)="test()">test</button>
}
